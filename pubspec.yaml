name: permissionless_dart_workspace
publish_to: none

environment:
  sdk: ">=3.5.0 <4.0.0"

workspace:
  # packages
  - packages/permissionless
  - packages/permissionless_passkeys

  # examples
  - packages/permissionless_passkeys/example

dev_dependencies:
  melos: ^7.0.0

melos:
  name: permissionless_dart
  repository: https://github.com/LiorAgnin/permissionless.dart

  command:
    version:
      linkToCommits: true
      workspaceChangelog: false

  scripts:
    analyze:
      description: Run static analysis on all packages
      run: dart analyze

    test:
      description: Run tests in all packages
      run: melos exec -- flutter test

    test:coverage:
      description: Run tests with coverage
      run: melos exec -- flutter test --coverage

    format:
      description: Format all Dart files
      run: dart format .

    format:check:
      description: Check formatting of all Dart files
      run: dart format --set-exit-if-changed .

    clean:
      description: Clean all packages
      run: melos exec -- flutter clean

    pub:get:
      description: Get dependencies for all packages
      run: dart pub get

    build:runner:
      description: Run build_runner for packages that need it
      run: melos exec --depends-on="build_runner" -- dart run build_runner build --delete-conflicting-outputs
